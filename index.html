<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fun Insight - Working Memory Adventure</title>
<style>
body {
  font-family: 'Arial', sans-serif;
  background: linear-gradient(135deg, #7f8cfa, #74ebd5);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  min-height: 100vh;
  margin: 0;
  padding: 20px;
  color: #fff;
  overflow-x: hidden;
}
h1 { margin-bottom: 10px; text-align:center; }
.game-container { display: flex; flex-direction: column; align-items: center; margin-top: 20px; }
.sequence-display { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; justify-content:center;}
.shape { width: 60px; height: 60px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; transition: transform 0.2s, box-shadow 0.2s; }
.shape:hover { transform: scale(1.2); box-shadow: 0 0 15px rgba(255,255,255,0.7); }
.feedback { margin-top: 20px; text-align: center; font-size: 18px; min-height:24px; }
.metrics { margin-top: 15px; background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; width: 320px; text-align: left; transition: all 0.3s; }
.star { color: gold; font-size: 24px; animation: bounce 0.5s ease; }
@keyframes bounce { 0% {transform: scale(0);} 50% {transform: scale(1.3);} 100% {transform: scale(1);} }
.confetti { position: absolute; width: 10px; height: 10px; background: gold; top:0; animation: fall 1s linear forwards; border-radius:50%; }
@keyframes fall { 0% {top:0; opacity:1;} 100% {top:100vh; opacity:0;} }
button { margin-top: 15px; padding: 10px 20px; border: none; border-radius: 8px; background: #f39c12; color: #fff; font-size: 16px; cursor: pointer; transition: transform 0.2s; }
button:hover { background: #e67e22; transform: scale(1.05); }
.progress-bar-container { width: 300px; height: 15px; background: rgba(255,255,255,0.3); border-radius: 10px; margin-top: 10px; }
.progress-bar { height: 100%; background: #f1c40f; width: 0%; border-radius: 10px; transition: width 0.5s; }
</style>
</head>
<body>

<h1>Fun Insight - Working Memory Adventure</h1>
<div class="game-container">
  <div class="sequence-display" id="sequenceDisplay"></div>
  <div class="feedback" id="feedback">Press Start to begin your brain adventure!</div>
  <div class="progress-bar-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>
  <div class="metrics" id="metrics" style="display:none;"></div>
  <button id="startBtn">Start Adventure</button>
</div>

<script>
const shapes = ['üîµ','üü¢','üü†','üî∫','‚¨õ'];
let sequence = [];
let userInput = [];
let stage = 1;
let totalAttempts = 0;
let correctAttempts = 0;
let maxStageCompleted = 0;
let reactionTimes = [];
let stageReactionTimes = [];
let sequenceStartTime;
const totalLevels = 12; // max for progress bar scaling

const sequenceDisplay = document.getElementById('sequenceDisplay');
const feedback = document.getElementById('feedback');
const metrics = document.getElementById('metrics');
const startBtn = document.getElementById('startBtn');
const progressBar = document.getElementById('progressBar');

function sleep(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }

function spawnConfetti() {
  for(let i=0;i<25;i++){
    const c = document.createElement('div');
    c.className='confetti';
    c.style.left=Math.random()*window.innerWidth+'px';
    c.style.background=['#f1c40f','#e67e22','#e74c3c','#1abc9c','#9b59b6'][Math.floor(Math.random()*5)];
    document.body.appendChild(c);
    setTimeout(()=>document.body.removeChild(c),1000);
  }
}

function updateProgressBar() {
  progressBar.style.width = Math.min((stage/totalLevels)*100,100) + '%';
}

function generateSequence(len, backward=false) {
  let seq = [];
  for (let i=0;i<len;i++){
    seq.push(shapes[Math.floor(Math.random()*shapes.length)]);
  }
  if(backward) seq.reverse(); // optional backward sequence
  return seq;
}

async function showSequence() {
  feedback.innerText = `Stage ${stage}: Memorize the sequence!`;
  sequenceDisplay.innerHTML = '';
  stageReactionTimes = [];
  updateProgressBar();
  for (let s of sequence) {
    const div = document.createElement('div');
    div.className = 'shape';
    div.innerText = s;
    sequenceDisplay.appendChild(div);
    await sleep(700);
    div.style.opacity = '0';
    await sleep(200);
  }
  sequenceDisplay.innerHTML = '';
  feedback.innerText = "Repeat the sequence!";
  renderShapeButtons();
  sequenceStartTime = Date.now();
}

function renderShapeButtons() {
  sequenceDisplay.innerHTML = '';
  for (let s of shapes) {
    const div = document.createElement('div');
    div.className = 'shape';
    div.innerText = s;
    div.onclick = () => handleUserInput(s, div);
    sequenceDisplay.appendChild(div);
  }
}

function handleUserInput(shape, divElement) {
  const currentTime = Date.now();
  const reaction = currentTime - sequenceStartTime;
  stageReactionTimes.push(reaction);
  sequenceStartTime = currentTime;

  userInput.push(shape);
  divElement.style.boxShadow='0 0 20px #fff';
  setTimeout(()=>divElement.style.boxShadow='',200);

  if (userInput.length === sequence.length) {
    totalAttempts++;
    const correct = userInput.every((val,i) => val === sequence[i]);
    if (correct) {
      correctAttempts++;
      maxStageCompleted = Math.max(maxStageCompleted, stage);
      feedback.innerHTML = `‚úÖ Stage ${stage} complete! <span class="star">‚≠ê</span>`;
      spawnConfetti();
      stage++;
      let backward = (stage%3===0); // every 3rd stage backward for manipulation
      sequence = generateSequence(stage + 2, backward);
      userInput = [];
      setTimeout(showSequence, 1000);
    } else {
      feedback.innerHTML = `‚ùå Incorrect! Adventure ended at Stage ${stage}.`;
      reactionTimes.push(...stageReactionTimes);
      showFinalResults();
    }
  }
}

function showFinalResults() {
  const accuracy = Math.round((correctAttempts/totalAttempts)*100);
  const avgReaction = Math.round(reactionTimes.reduce((a,b)=>a+b,0)/reactionTimes.length);
  const consistency = Math.round(100 - (Math.max(...reactionTimes)-Math.min(...reactionTimes))/avgReaction*100);
  let insight;
  if(maxStageCompleted>=10) insight = "üß† Memory Master! Your brain is exceptional!";
  else if(maxStageCompleted>=7) insight = "üåü Brain Wizard! Above Average Memory.";
  else if(maxStageCompleted>=4) insight = "‚ö° Average Memory, keep training!";
  else insight = "üê¢ Focus Ninja Needed! Practice more.";

  metrics.style.display = 'block';
  metrics.innerHTML = `
    <strong>Raw Data:</strong><br>
    Max Stage Completed: ${maxStageCompleted}<br>
    Accuracy: ${accuracy}%<br>
    Avg Reaction Time: ${avgReaction} ms<br>
    Consistency: ${consistency}%<br>
    Total Attempts: ${totalAttempts}<br><br>
    <strong>Insight-Fun:</strong><br>
    ${insight}
  `;
  sequenceDisplay.innerHTML = '';
  startBtn.style.display = 'inline-block';
  progressBar.style.width='0%';
}

startBtn.onclick = () => {
  stage = 1;
  totalAttempts = 0;
  correctAttempts = 0;
  maxStageCompleted = 0;
  reactionTimes = [];
  metrics.style.display='none';
  startBtn.style.display='none';
  let backward = false;
  sequence = generateSequence(stage + 2, backward);
  showSequence();
};
</script>

</body>
</html>
